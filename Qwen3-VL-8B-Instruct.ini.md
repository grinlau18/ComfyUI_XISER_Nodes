Qwen3-VL-8B-Instruct
æ¥è®¤è¯†ä¸€ä¸‹Qwen3-VLâ€”â€”è¿„ä»Šä¸ºæ­¢Qwenç³»åˆ—ä¸­æœ€å¼ºå¤§çš„è§†è§‰-è¯­è¨€æ¨¡å‹ã€‚

è¿™ä¸€ä»£äº§å“åœ¨å„æ–¹é¢éƒ½å®ç°äº†å…¨é¢å‡çº§ï¼šæ›´å‡ºè‰²çš„æ–‡æœ¬ç†è§£ä¸ç”Ÿæˆèƒ½åŠ›ã€æ›´æ·±å…¥çš„è§†è§‰æ„ŸçŸ¥ä¸æ¨ç†èƒ½åŠ›ã€æ›´é•¿çš„ä¸Šä¸‹æ–‡é•¿åº¦ã€æ›´å¼ºçš„ç©ºé—´å’Œè§†é¢‘åŠ¨æ€ç†è§£èƒ½åŠ›ï¼Œä»¥åŠæ›´å¼ºå¤§çš„æ™ºèƒ½ä½“äº¤äº’èƒ½åŠ›ã€‚

æä¾›å¯†é›†å‹å’Œæ··åˆä¸“å®¶ï¼ˆMoEï¼‰ä¸¤ç§æ¶æ„ï¼Œå¯ä»è¾¹ç¼˜è®¾å¤‡æ‰©å±•è‡³äº‘ç«¯ï¼Œè¿˜å…·å¤‡æŒ‡ä»¤ç‰ˆå’Œå¢å¼ºæ¨ç†èƒ½åŠ›çš„æ€ç»´ç‰ˆï¼Œæ”¯æŒçµæ´»çš„æŒ‰éœ€éƒ¨ç½²ã€‚

ä¸»è¦å¢å¼ºåŠŸèƒ½ï¼š
è§†è§‰æ™ºèƒ½ä½“ï¼šæ“ä½œç”µè„‘/ç§»åŠ¨è®¾å¤‡å›¾å½¢ç”¨æˆ·ç•Œé¢â€”â€”è¯†åˆ«å…ƒç´ ã€ç†è§£åŠŸèƒ½ã€è°ƒç”¨å·¥å…·ã€å®Œæˆä»»åŠ¡ã€‚

è§†è§‰ç¼–ç å¢å¼ºï¼šä»å›¾åƒ/è§†é¢‘ç”ŸæˆDraw.io/HTML/CSS/JSã€‚

é«˜çº§ç©ºé—´æ„ŸçŸ¥ï¼šåˆ¤æ–­ç‰©ä½“ä½ç½®ã€è§†è§’å’Œé®æŒ¡æƒ…å†µï¼›æä¾›æ›´å¼ºçš„2Då®šä½èƒ½åŠ›ï¼Œå¹¶æ”¯æŒç”¨äºç©ºé—´æ¨ç†å’Œå…·èº«äººå·¥æ™ºèƒ½çš„3Då®šä½ã€‚

é•¿ä¸Šä¸‹æ–‡ä¸è§†é¢‘ç†è§£ï¼šåŸç”Ÿ256Kä¸Šä¸‹æ–‡ï¼Œå¯æ‰©å±•è‡³100ä¸‡ï¼›èƒ½å¤„ç†ä¹¦ç±å’Œæ—¶é•¿æ•°å°æ—¶çš„è§†é¢‘ï¼Œå…·å¤‡å®Œæ•´å›å¿†èƒ½åŠ›å’Œç§’çº§ç´¢å¼•åŠŸèƒ½ã€‚

å¢å¼ºçš„å¤šæ¨¡æ€æ¨ç†èƒ½åŠ›ï¼šåœ¨STEM/æ•°å­¦é¢†åŸŸè¡¨ç°å‡ºè‰²â€”â€”æ“…é•¿å› æœåˆ†æä»¥åŠæä¾›ç¬¦åˆé€»è¾‘ã€åŸºäºè¯æ®çš„ç­”æ¡ˆã€‚

å‡çº§åçš„è§†è§‰è¯†åˆ«ï¼šæ›´å¹¿æ³›ã€æ›´é«˜è´¨é‡çš„é¢„è®­ç»ƒä½¿å…¶èƒ½å¤Ÿâ€œè¯†åˆ«ä¸‡ç‰©â€â€”â€”åäººã€åŠ¨æ¼«ã€äº§å“ã€åœ°æ ‡ã€åŠ¨æ¤ç‰©ç­‰ã€‚

æ‰©å±•å…‰å­¦å­—ç¬¦è¯†åˆ«ï¼ˆOCRï¼‰ï¼šæ”¯æŒ32ç§è¯­è¨€ï¼ˆæ­¤å‰ä¸º19ç§ï¼‰ï¼›åœ¨ä½å…‰ã€æ¨¡ç³Šå’Œå€¾æ–œæƒ…å†µä¸‹è¡¨ç°ç¨³å®šï¼›å¯¹ç½•è§/å¤æ–‡å­—å’Œä¸“ä¸šæœ¯è¯­è¯†åˆ«æ›´å‡ºè‰²ï¼›æ”¹è¿›äº†é•¿æ–‡æ¡£ç»“æ„è§£æèƒ½åŠ›ã€‚

æ–‡æœ¬ç†è§£èƒ½åŠ›ä¸çº¯å¤§è¯­è¨€æ¨¡å‹ç›¸å½“ï¼šæ— ç¼çš„æ–‡æœ¬-è§†è§‰èåˆï¼Œå®ç°æ— æŸã€ç»Ÿä¸€çš„ç†è§£ã€‚

æ¨¡å‹æ¶æ„æ›´æ–°ï¼š



äº¤é”™å¼MRoPEï¼šé€šè¿‡ç¨³å¥çš„ä½ç½®åµŒå…¥åœ¨æ—¶é—´ã€å®½åº¦å’Œé«˜åº¦ä¸Šè¿›è¡Œå…¨é¢‘ç‡åˆ†é…ï¼Œå¢å¼ºé•¿æ—¶è§†é¢‘æ¨ç†èƒ½åŠ›ã€‚

DeepStackï¼šèåˆå¤šçº§è§†è§‰Transformerï¼ˆViTï¼‰ç‰¹å¾ï¼Œä»¥æ•æ‰ç»†ç²’åº¦ç»†èŠ‚å¹¶å¢å¼ºå›¾æ–‡å¯¹é½ã€‚

æ–‡æœ¬-æ—¶é—´æˆ³å¯¹é½ï¼š è¶…è¶ŠT-RoPEï¼Œå®ç°ç²¾ç¡®çš„ã€åŸºäºæ—¶é—´æˆ³çš„äº‹ä»¶å®šä½ï¼Œä»¥å¢å¼ºè§†é¢‘æ—¶é—´å»ºæ¨¡ã€‚

è¿™æ˜¯Qwen3-VL-8B-Instructçš„æƒé‡ä»“åº“ã€‚

æ¨¡å‹æ€§èƒ½
å¤šæ¨¡æ€æ€§èƒ½



çº¯æ–‡æœ¬æ€§èƒ½


å¿«é€Ÿå…¥é—¨
ä¸‹é¢ï¼Œæˆ‘ä»¬æä¾›ç®€å•çš„ç¤ºä¾‹æ¥å±•ç¤ºå¦‚ä½•ç»“åˆğŸ¤–é­”æ­ç¤¾åŒºï¼ˆModelScopeï¼‰å’ŒğŸ¤—Transformersä½¿ç”¨Qwen3-VLã€‚

Qwen3-VLçš„ä»£ç å·²åŒ…å«åœ¨æœ€æ–°ç‰ˆçš„Hugging Face transformersä¸­ï¼Œå»ºè®®æ‚¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»æºä»£ç æ„å»ºï¼š

pip install git+https://github.com/huggingface/transformers
# pip install transformers==4.57.0 # currently, V4.57.0 is not released

ä½¿ç”¨ğŸ¤—Transformersè¿›è¡ŒèŠå¤©
ä¸‹é¢æˆ‘ä»¬å±•ç¤ºä¸€æ®µä»£ç ç‰‡æ®µï¼Œä»¥è¯´æ˜å¦‚ä½•å°†èŠå¤©æ¨¡å‹ä¸transformersç»“åˆä½¿ç”¨ï¼š

from transformers import Qwen3VLForConditionalGeneration, AutoProcessor

# default: Load the model on the available device(s)
model = Qwen3VLForConditionalGeneration.from_pretrained(
    "Qwen/Qwen3-VL-8B-Instruct", dtype="auto", device_map="auto"
)

# We recommend enabling flash_attention_2 for better acceleration and memory saving, especially in multi-image and video scenarios.
# model = Qwen3VLForConditionalGeneration.from_pretrained(
#     "Qwen/Qwen3-VL-8B-Instruct",
#     dtype=torch.bfloat16,
#     attn_implementation="flash_attention_2",
#     device_map="auto",
# )

processor = AutoProcessor.from_pretrained("Qwen/Qwen3-VL-8B-Instruct")

messages = [
    {
        "role": "user",
        "content": [
            {
                "type": "image",
                "image": "https://qianwen-res.oss-cn-beijing.aliyuncs.com/Qwen-VL/assets/demo.jpeg",
            },
            {"type": "text", "text": "Describe this image."},
        ],
    }
]

# Preparation for inference
inputs = processor.apply_chat_template(
    messages,
    tokenize=True,
    add_generation_prompt=True,
    return_dict=True,
    return_tensors="pt"
)
inputs = inputs.to(model.device)

# Inference: Generation of the output
generated_ids = model.generate(**inputs, max_new_tokens=128)
generated_ids_trimmed = [
    out_ids[len(in_ids) :] for in_ids, out_ids in zip(inputs.input_ids, generated_ids)
]
output_text = processor.batch_decode(
    generated_ids_trimmed, skip_special_tokens=True, clean_up_tokenization_spaces=False
)
print(output_text)

ç”Ÿæˆè¶…å‚æ•°
VL
export greedy='false'
export top_p=0.8
export top_k=20
export temperature=0.7
export repetition_penalty=1.0
export presence_penalty=1.5
export out_seq_length=16384

æ–‡æœ¬
export greedy='false'
export top_p=1.0
export top_k=40
export repetition_penalty=1.0
export presence_penalty=2.0
export temperature=1.0
export out_seq_length=32768

å¼•ç”¨
å¦‚æœæ‚¨è§‰å¾—æˆ‘ä»¬çš„å·¥ä½œæœ‰å¸®åŠ©ï¼Œæ¬¢è¿å¼•ç”¨æˆ‘ä»¬çš„æˆæœã€‚

@misc{qwen3technicalreport,
      title={Qwen3 Technical Report}, 
      author={Qwen Team},
      year={2025},
      eprint={2505.09388},
      archivePrefix={arXiv},
      primaryClass={cs.CL},
      url={https://arxiv.org/abs/2505.09388}, 
}

@article{Qwen2.5-VL,
  title={Qwen2.5-VL Technical Report},
  author={Bai, Shuai and Chen, Keqin and Liu, Xuejing and Wang, Jialin and Ge, Wenbin and Song, Sibo and Dang, Kai and Wang, Peng and Wang, Shijie and Tang, Jun and Zhong, Humen and Zhu, Yuanzhi and Yang, Mingkun and Li, Zhaohai and Wan, Jianqiang and Wang, Pengfei and Ding, Wei and Fu, Zheren and Xu, Yiheng and Ye, Jiabo and Zhang, Xi and Xie, Tianbao and Cheng, Zesen and Zhang, Hang and Yang, Zhibo and Xu, Haiyang and Lin, Junyang},
  journal={arXiv preprint arXiv:2502.13923},
  year={2025}
}

@article{Qwen2VL,
  title={Qwen2-VL: Enhancing Vision-Language Model's Perception of the World at Any Resolution},
  author={Wang, Peng and Bai, Shuai and Tan, Sinan and Wang, Shijie and Fan, Zhihao and Bai, Jinze and Chen, Keqin and Liu, Xuejing and Wang, Jialin and Ge, Wenbin and Fan, Yang and Dang, Kai and Du, Mengfei and Ren, Xuancheng and Men, Rui and Liu, Dayiheng and Zhou, Chang and Zhou, Jingren and Lin, Junyang},
  journal={arXiv preprint arXiv:2409.12191},
  year={2024}
}

@article{Qwen-VL,
  title={Qwen-VL: A Versatile Vision-Language Model for Understanding, Localization, Text Reading, and Beyond},
  author={Bai, Jinze and Bai, Shuai and Yang, Shusheng and Wang, Shijie and Tan, Sinan and Wang, Peng and Lin, Junyang and Zhou, Chang and Zhou, Jingren},
  journal={arXiv preprint arXiv:2308.12966},
  year={2023}
}



ä¸€ã€é¡µé¢æ ¸å¿ƒå†…å®¹æ€»ç»“
Qwen3-VL-8B-Instruct æ˜¯ Qwen ç³»åˆ—æœ€æ–°çš„å¤šæ¨¡æ€è§†è§‰ - è¯­è¨€æ¨¡å‹ï¼Œå‘å¸ƒäº 2025 å¹´ 10 æœˆï¼Œæ ¸å¿ƒä¼˜åŠ¿ä¸å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š
æ ¸å¿ƒèƒ½åŠ›ï¼šæ”¯æŒå›¾æ–‡ç†è§£ä¸ç”Ÿæˆã€è§†è§‰æ¨ç†ã€é•¿ä¸Šä¸‹æ–‡å¤„ç†ï¼ˆåŸç”Ÿ 256Kï¼Œå¯æ‰©å±•è‡³ 1Mï¼‰ã€è§†é¢‘ç†è§£ã€OCRï¼ˆ32 ç§è¯­è¨€ï¼‰ã€ç©ºé—´æ„ŸçŸ¥ï¼ˆ2D/3D groundingï¼‰ã€è§†è§‰ä»£ç†ï¼ˆæ“ä½œ GUIï¼‰ã€è§†è§‰ç¼–ç ï¼ˆç”Ÿæˆ Draw.io/HTML/CSS/JSï¼‰ç­‰ã€‚
æŠ€æœ¯æ¶æ„ï¼šé‡‡ç”¨ Dense/MoE è§£ç å™¨æ¶æ„ï¼Œæ­è½½ Interleaved-MRoPE ä½ç½®ç¼–ç ã€DeepStack ç‰¹å¾èåˆã€Text-Timestamp Alignment è§†é¢‘æ—¶åºå»ºæ¨¡ç­‰ä¼˜åŒ–æ–¹æ¡ˆã€‚
æ€§èƒ½è¡¨ç°ï¼šåœ¨ STEM / æ•°å­¦ã€é€šç”¨ VQAã€OCRã€æ–‡æ¡£ç†è§£ã€è§†é¢‘åˆ†æç­‰ä»»åŠ¡ä¸­è¡¨ç°ä¼˜å¼‚ï¼Œä¼˜äºå¤šæ¬¾åŒç±»æ¨¡å‹ï¼ˆå¦‚ Gemini2.5-Flashã€GPT5-Nanoï¼‰ï¼Œçº¯æ–‡æœ¬èƒ½åŠ›æ¯”è‚©ä¸“ç”¨ LLMã€‚
è°ƒç”¨ç›¸å…³ï¼šåŸºäº Hugging Face Transformers æ¡†æ¶ï¼Œæ”¯æŒ BF16 å¼ é‡ç±»å‹ï¼Œéœ€é€šè¿‡ç‰¹å®š Processor å¤„ç†å›¾æ–‡è¾“å…¥ï¼Œæ¨ç†å‚æ•°å¯è‡ªå®šä¹‰ï¼ˆtemperatureã€top_p ç­‰ï¼‰ã€‚
äºŒã€å¼€å‘ ComfyUI è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ ¸å¿ƒå‚è€ƒå†…å®¹
1. æ¨¡å‹åŠ è½½æ ¸å¿ƒé…ç½®
ä¾èµ–åº“ï¼šå¿…é¡»å¼•å…¥ transformersï¼ˆéœ€ä»æºç å®‰è£…æœ€æ–°ç‰ˆï¼‰ã€torchã€PILã€safetensorsï¼Œå¯é€‰ accelerateï¼ˆä¼˜åŒ–éƒ¨ç½²ï¼‰ã€flash_attn_2ï¼ˆåŠ é€Ÿæ¨ç†ï¼‰ã€‚
åŠ è½½ç±»ï¼šä½¿ç”¨ Qwen3VLForConditionalGeneration åŠ è½½æ¨¡å‹ï¼ŒAutoProcessor å¤„ç†è¾“å…¥ï¼ˆå›¾æ–‡ç»Ÿä¸€ç¼–ç ï¼‰ï¼Œéœ€æŒ‡å®š trust_remote_code=Trueã€‚
è®¾å¤‡ä¸ç²¾åº¦ï¼šé»˜è®¤è‡ªåŠ¨é€‚é…è®¾å¤‡ï¼ˆdevice_map="auto"ï¼‰ï¼Œæ¨èä½¿ç”¨ torch.bfloat16 ç²¾åº¦ï¼Œæ”¯æŒ GPU/CPU éƒ¨ç½²ï¼Œæ˜¾å­˜ä¸è¶³æ—¶å¯å¯ç”¨ 4bit/8bit é‡åŒ–ã€‚
ç¼“å­˜æœºåˆ¶ï¼šæ¨¡å‹ä½“ç§¯çº¦ 9B å‚æ•°ï¼Œéœ€è®¾è®¡å…¨å±€ç¼“å­˜ï¼ˆå¦‚ MODEL_CACHEï¼‰ï¼Œé¿å…é‡å¤åŠ è½½å ç”¨èµ„æºã€‚
2. è¾“å…¥è¾“å‡ºè®¾è®¡ä¾æ®
è¾“å…¥ç±»å‹ï¼š
è§†è§‰è¾“å…¥ï¼šæ”¯æŒå›¾ç‰‡ã€è§†é¢‘ï¼ˆéœ€å¤„ç†å¸§æå–ä¸æ—¶é—´æˆ³å¯¹é½ï¼‰ï¼ŒComfyUI èŠ‚ç‚¹éœ€é€‚é…å…¶ IMAGE å¼ é‡æ ¼å¼ï¼ˆ[batch, height, width, channel]ï¼Œ0-1 å–å€¼ï¼‰ã€‚
æ–‡æœ¬è¾“å…¥ï¼šæ”¯æŒå•è½® / å¤šè½®å¯¹è¯ï¼Œéœ€éµå¾ªæ¨¡å‹è¦æ±‚çš„èŠå¤©æ¨¡æ¿ï¼ˆapply_chat_templateï¼‰ï¼ŒåŒ…å« system/user è§’è‰²ï¼Œå›¾æ–‡å†…å®¹éœ€æŒ‰ {"type": "image"}/{"type": "text"} ç»“æ„åŒ–ä¼ å…¥ã€‚
è¾“å‡ºç±»å‹ï¼šä»¥æ–‡æœ¬ä¸ºä¸»ï¼ˆæ¨¡å‹ç”Ÿæˆçš„æè¿°ã€æ¨ç†ç»“æœã€ä»£ç ç­‰ï¼‰ï¼ŒComfyUI èŠ‚ç‚¹è¿”å› STRING ç±»å‹ï¼Œå¯æ‰©å±•æ”¯æŒç»“æ„åŒ–è¾“å‡ºï¼ˆå¦‚ OCR ç»“æœå­—å…¸ã€åæ ‡ä¿¡æ¯ï¼‰ã€‚
3. å…³é”®å‚æ•°é…ç½®ï¼ˆéœ€æš´éœ²ç»™èŠ‚ç‚¹ç”¨æˆ·ï¼‰
æ¨¡å‹ç›¸å…³ï¼šæœ¬åœ°æ¨¡å‹è·¯å¾„ï¼ˆæ”¯æŒè‡ªå®šä¹‰ç›®å½•é€‰æ‹©ï¼‰ã€‚
ç”Ÿæˆå‚æ•°ï¼š
è§†è§‰ - è¯­è¨€ä»»åŠ¡ï¼štemperature=0.7ã€top_p=0.8ã€top_k=20ã€max_new_tokens=16384ã€repetition_penalty=1.0ã€presence_penalty=1.5ã€‚
çº¯æ–‡æœ¬ä»»åŠ¡ï¼štemperature=1.0ã€top_p=1.0ã€top_k=40ã€max_new_tokens=32768ã€presence_penalty=2.0ã€‚
åŠŸèƒ½å¼€å…³ï¼šæ˜¯å¦å¯ç”¨ flash_attention_2ï¼ˆåŠ é€Ÿï¼‰ã€è§†é¢‘å¸§é‡‡æ ·é—´éš”ï¼ˆå¤„ç†é•¿è§†é¢‘æ—¶ï¼‰ã€OCR è¯­è¨€é€‰æ‹©ï¼ˆ32 ç§å¯é€‰ï¼‰ã€‚
4. æ ¸å¿ƒæŠ€æœ¯é€‚é…ç‚¹
å›¾æ–‡èåˆå¤„ç†ï¼šé€šè¿‡ processor ç»Ÿä¸€ç¼–ç å›¾ç‰‡ä¸æ–‡æœ¬ï¼Œéœ€è°ƒç”¨ apply_chat_template ç”Ÿæˆæ¨¡å‹å¯è¯†åˆ«çš„è¾“å…¥æ ¼å¼ï¼Œæ·»åŠ  add_generation_prompt=True è§¦å‘ç”Ÿæˆã€‚
è§†é¢‘å¤„ç†ï¼šæ”¯æŒå°æ—¶çº§è§†é¢‘è¾“å…¥ï¼Œéœ€å¤„ç†å¸§åµŒå…¥ï¼ˆVideo frame embsï¼‰ä¸æ—¶é—´æˆ³å¯¹é½ï¼ˆText-Timestamp Alignmentï¼‰ï¼ŒèŠ‚ç‚¹å¯æ‰©å±•å¸§æå–ä¸æ—¶åºå»ºæ¨¡åŠŸèƒ½ã€‚
OCR ä¸æ–‡æ¡£ç†è§£ï¼šæ¨¡å‹æ”¯æŒä½å…‰ã€æ¨¡ç³Šã€å€¾æ–œåœºæ™¯åŠç”Ÿåƒ»å­— / å¤æ–‡å­—è¯†åˆ«ï¼ŒèŠ‚ç‚¹å¯é’ˆå¯¹é•¿æ–‡æ¡£æ·»åŠ åˆ†å—å¤„ç†é€»è¾‘ã€‚
ç©ºé—´æ„ŸçŸ¥é€‚é…ï¼šè‹¥éœ€æ”¯æŒ 2D/3D grounding åŠŸèƒ½ï¼ŒèŠ‚ç‚¹éœ€è¾“å‡ºåæ ‡ä¿¡æ¯ï¼ˆå¦‚ç›®æ ‡æ£€æµ‹æ¡†ã€3D ä½ç½®ï¼‰ï¼Œæ‰©å±•è¿”å›ç±»å‹ä¸º STRING+BOX/POINTã€‚
5. æ€§èƒ½ä¼˜åŒ–å‚è€ƒ
å¯ç”¨ flash_attention_2 æå‡æ¨ç†é€Ÿåº¦ä¸æ˜¾å­˜åˆ©ç”¨ç‡ï¼Œå°¤å…¶é€‚ç”¨äºå¤šå›¾ / è§†é¢‘åœºæ™¯ã€‚
é‡‡ç”¨ DeepStack ç‰¹å¾èåˆé€»è¾‘ï¼Œå¯ä¼˜åŒ–å›¾ç‰‡ç»†èŠ‚æ•æ‰ï¼ˆèŠ‚ç‚¹æ— éœ€é¢å¤–å®ç°ï¼Œæ¨¡å‹å†…ç½®ï¼‰ã€‚
é•¿ä¸Šä¸‹æ–‡å¤„ç†ï¼šåˆ©ç”¨æ¨¡å‹åŸç”Ÿ 256K ä¸Šä¸‹æ–‡ä¼˜åŠ¿ï¼ŒèŠ‚ç‚¹å¯æ”¯æŒé•¿æ–‡æ¡£ï¼ˆå¦‚ä¹¦ç±ï¼‰ã€é•¿è§†é¢‘çš„æ‰¹é‡å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨åˆ†å—ã€‚